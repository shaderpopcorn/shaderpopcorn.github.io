<!DOCTYPE html>
<html>
    <head>
        <title>SHADERPOPCORN - The interactive shader site to play with.</title>
        <meta charset="utf-8">
        <meta name="description" content="On this site you can play with preprogramed shaders.">
        <meta name="author" content="KW">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
        <link rel="stylesheet" href="css/style.css">
    </head>

    <body>
        <div id="container"></div>

        <div id="radiocb" class="footer-button">
            <input type="checkbox" id="contact" class="contact-button"/>
            <input type="checkbox" id="code" class="code-button"/>
            <input type="checkbox" onclick="window.location.href='http://instagram.com/shaderpopcorn'"/>
        </div>

        <div id="contact-overlay" class="contact-overlay" style="opacity: 0;">
            <div id="contact-text" class="contact-text">kay@shaderpopcorn.com</div>
        </div>

        <div id="code-overlay" class="code-overlay" style="opacity: 0;">
            <div id="code-text" class="code-text">
                    #version 150

                    uniform float time;
                    uniform vec2 resolution;
                    uniform vec2 mouse;

                    float PI = 3.1415;
                    float PI2 = 6.283;

                    in VertexData{vec4 v_position;vec3 v_normal;vec2 v_texcoord;} inData;
                    out vec4 fragColor;

                    float hexDist(vec2 uv){
                        uv = abs(uv);
                        float d = dot(uv, normalize(vec2(1.,1.73)));
                        d = max(d, uv.x);
                        return d;}

                    void main(void){
                        vec2 uv = (gl_FragCoord.xy -.5*resolution.xy)/resolution.y;
                        vec4 col = vec4(.0);

                        uv *= 5.;

                        float an = PI/2.;
                        uv *= mat2(cos(an),-sin(an),sin(an),cos(an));

                        vec2 r = vec2(1.,1.73);
                        vec2 h = r*.5;

                        vec2 gv;
                        vec2 gv1 = mod(uv, r)-h;
                        vec2 gv2 = mod(uv-h, r)-h;

                        if(length(gv1) < length(gv2)) gv = gv1;
                        else gv = gv2;

                        float x = atan(gv.x,gv.y)/PI2+.5;
                        float y = 0.;

                        vec2 gvA = gv;
                        vec2 gvB = gv;
                        vec2 gvC = gv;

                        float zo = (mouse.x+.1)*30.;

                        if(x>0. && x<1./3.) {
                            gvA += vec2(.25,.14);
                            float anA = PI/3.;
                            gvA *= mat2(cos(anA),-sin(anA),sin(anA),cos(anA));
                            gvA *= zo;
                            gvA.y = abs(gvA.y);
                            gvA.y -= time;
                            float d = sin(gvA.x+gvA.y*1.73);
                            float m = smoothstep(.1,.0,d);
                            col += vec4(m);
                        }

                        if(x>1./3. && x<1./3.*2.) {
                            gvB += vec2(.0,-.2925);
                            float aB = PI/1.;
                            gvB *= mat2(cos(aB),-sin(aB),sin(aB),cos(aB));
                            gvB *= zo;
                            gvB.y = abs(gvB.y);
                            gvB.y -= time;
                            float d = sin(gvB.x+gvB.y*1.73);
                            float m = smoothstep(.1,.0,d);
                            col += vec4(m);
                        }

                        if(x>1./3.*2. && x<1.) {
                            gvC += vec2(-.25,.14);
                            float aC = 1.-PI/1.53;
                            gvC *= mat2(cos(aC),-sin(aC),sin(aC),cos(aC));
                            gvC *= zo;
                            gvC.y = abs(gvC.y);
                            gvC.y -= time;
                            float d = sin(gvC.x+gvC.y*1.73);
                            float m = smoothstep(.1,.0,d);
                            col += vec4(m);
                        }

                        fragColor = col;
                    }

                </div>
        </div>

        <script src="lib/three.js"></script>
        <script src="lib/gl-matrix.js"></script>
        <script>

            // First we check if you support touch, otherwise it's click:
            let touchEvent = 'ontouchstart' in window ? 'touchstart' : 'click';

            // Then we bind via th√°t event. This way we only bind one event, instead of the two as below
            document.getElementById('radiocb').addEventListener(touchEvent, cbclick(event));

            function cbclick(e){
               e = e || event;
               var cb = e.srcElement || e.target;
               if (cb.type !== 'checkbox') {return true;}
               var cbxs = document.getElementById('radiocb').getElementsByTagName('input'), i=cbxs.length;
                while(i--) {
                    if (cbxs[i].type && cbxs[i].type == 'checkbox' && cbxs[i].id !== cb.id) {
                    cbxs[i].checked = false;
                    }
                }

                let overlayContact = document.querySelector(".contact-overlay");
                if (cbxs[0].checked == true) overlayContact.style.opacity = 1;
                else overlayContact.style.opacity = 0;

                let overlayCode = document.querySelector(".code-overlay");
                if (cbxs[1].checked == true) overlayCode.style.opacity = 1;
                else overlayCode.style.opacity = 0;

                let overlayInstagram = document.querySelector(".instagram-overlay");
                if (cbxs[2].checked == true) overlayInstagram.style.opacity = 1;
                else overlayInstagram.style.opacity = 0;

                //     if the click should always result in a checked checkbox
                //     unconmment this:
                //     cb.checked = true;

            }

            var container;
            var renderer,  camera, scene;
            var vShader, fShader;
            var uniforms;
            var loader = new THREE.FileLoader();

            init();
            animate();

            function init() {

                container = document.getElementById('container');
                renderer = new THREE.WebGLRenderer();
                renderer.setPixelRatio(window.devicePixelRatio);
                container.appendChild(renderer.domElement);

                camera = new THREE.Camera();
                camera.position.z = 1;

                scene = new THREE.Scene();

                var numFilesLeft = 2;

                function runShaderIfDone() {
                    --numFilesLeft;
                    if (numFilesLeft === 0) {
                        shader();
                    }
                }

                loader.load('shader/SHADER_200622.frag', function(data) {
                    fShader = data;
                    runShaderIfDone();
                }, );
                loader.load('shader/DEFAULT.vert', function(data) {
                    vShader = data;
                    runShaderIfDone();
                }, );
            }

            function shader() {

                var texLoaderLogo = new THREE.TextureLoader();
                var texSamplerLogo = texLoaderLogo.load("images/LOGO_ALPHA.png");
                var texLoaderHeader = new THREE.TextureLoader();
                var texSamplerHeader = texLoaderHeader.load("images/SHADERPOPCORN_1024_ALPHA.png");
                var texLoaderEmail = new THREE.TextureLoader();
                var texSamplerEmail = texLoaderEmail.load("images/EMAIL_ALPHA.png");
                var texLoaderCode = new THREE.TextureLoader();
                var texSamplerCode = texLoaderCode.load("images/CODE_ALPHA.png");
                var texLoaderInstagram = new THREE.TextureLoader();
                var texSamplerInstagram = texLoaderInstagram.load("images/INSTAGRAM_ALPHA.png");

                // **************************
                uniforms = {
                    time: { type: "f", value: 1.0 },
                    resolution: { type: "v2", value: new THREE.Vector2() },
                    mouse: { type: "v2", value: new THREE.Vector2() },
                    logo:  { type: "t", value: texSamplerLogo },
                    msdfH: { type: "t", value: texSamplerHeader },
                    msdfE: { type: "t", value: texSamplerEmail },
                    msdfC: { type: "t", value: texSamplerCode },
                    msdfI: { type: "t", value: texSamplerInstagram },
                    click: { type: "f", value: 0.0 },
                    touch: { type: "f", value: 0.0 }
                };

                var material = new THREE.ShaderMaterial({
                    uniforms: uniforms,
                    vertexShader: vShader,
                    fragmentShader: fShader,
                });

                var geometry = new THREE.PlaneBufferGeometry(2, 2);
                var mesh = new THREE.Mesh(geometry, material);
                scene.add(mesh);

                onWindowResize();
                window.addEventListener('resize', onWindowResize, false);

                document.onmousedown = function(e) {
                    uniforms.click.value = 1.0;
                }

                document.onmouseup = function(e) {
                    uniforms.click.value = 0.0;
                }

                document.onmousemove = function(e) {
                    uniforms.mouse.value.x = e.pageX;
                    uniforms.mouse.value.y = e.pageY;
                }

                document.ontouchstart = function(e) {
                    e.preventDefault();
                    uniforms.touch.value = 1.0;
                    uniforms.mouse.value.x = e.pageX * 2;
                    uniforms.mouse.value.y = e.pageY * 2;
                }

                document.ontouchend = function(e) {
                    e.preventDefault();
                    uniforms.touch.value = 0.0;
                }

                document.ontouchmove = function(e) {
                    e.preventDefault();
                    uniforms.mouse.value.x = e.pageX * 2;
                    uniforms.mouse.value.y = e.pageY * 2;
                }
            }

            function onWindowResize(event) {
                renderer.setSize(window.innerWidth, window.innerHeight);
                uniforms.resolution.value.x = renderer.domElement.width;
                uniforms.resolution.value.y = renderer.domElement.height;
            }

            function animate() {
                requestAnimationFrame(animate);
                render();
            }

            function render() {
                uniforms.time.value += 0.05;
                renderer.render(scene, camera);
            }
        </script>
    </body>

</html>
