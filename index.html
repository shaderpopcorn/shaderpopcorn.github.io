<!DOCTYPE html>
<html>

<head>
    <title>shaderpopcorn</title>
    <meta charset="utf-8">
    <meta name="description" content="color">
    <meta name="author" content="KW">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="container"></div>
    <script src="lib/three.js"></script>
    <script src="lib/gl-matrix.js"></script>
    <script>
        var container;
        var renderer,  camera, scene;
        var vShader, fShader;
        var uniforms;
        var loader = new THREE.FileLoader();

        init();
        animate();

        function init() {

            container = document.getElementById('container');
            renderer = new THREE.WebGLRenderer();
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            camera = new THREE.Camera();
            camera.position.z = 1;

            scene = new THREE.Scene();

            var numFilesLeft = 2;

            function runShaderIfDone() {
                --numFilesLeft;
                if (numFilesLeft === 0) {
                    shader();
                }
            }

            loader.load('shader/SHADER.frag', function(data) {
                fShader = data;
                runShaderIfDone();
            }, );
            loader.load('shader/DEFAULT.vert', function(data) {
                vShader = data;
                runShaderIfDone();
            }, );
        }

        function shader() {

            var texLoader = new THREE.TextureLoader();
            var texSampler = texLoader.load("images/LOGO_ALPHA.png");
            var texLoader1 = new THREE.TextureLoader();
            var texSampler1 = texLoader1.load("images/SHADERPOPCORN_1024_ALPHA.png");
            var texLoader2 = new THREE.TextureLoader();
            var texSampler2 = texLoader2.load("images/kay_1024_ALPHA.png");

            // **************************
            uniforms = {
                time: { type: "f", value: 1.0 },
                resolution: { type: "v2", value: new THREE.Vector2() },
                mouse: { type: "v2", value: new THREE.Vector2() },
                logo: { type: "t", value: texSampler },
                msdfH: { type: "t", value: texSampler1 },
                msdfE: { type: "t", value: texSampler2 },
                click: { type: "f", value: 0.0 },
                touch: { type: "f", value: 0.0 }
            };

            var material = new THREE.ShaderMaterial({
                uniforms: uniforms,
                vertexShader: vShader,
                fragmentShader: fShader,
            });

            var geometry = new THREE.PlaneBufferGeometry(2, 2);
            var mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);

            onWindowResize();
            window.addEventListener('resize', onWindowResize, false);

             document.onmousedown = function(e) {
                uniforms.click.value = 1.0;
            }

            document.onmouseup = function(e) {
                uniforms.click.value = 0.0;
            }

            document.onmousemove = function(e) {
                uniforms.mouse.value.x = e.pageX;
                uniforms.mouse.value.y = e.pageY;
            }

            document.ontouchstart = function(e) {
                e.preventDefault();
                uniforms.touch.value = 1.0;
                uniforms.mouse.value.x = e.pageX * 2;
                uniforms.mouse.value.y = e.pageY * 2;
            }

            document.ontouchend = function(e) {
                e.preventDefault();
                uniforms.touch.value = 0.0;
            }

            document.ontouchmove = function(e) {
                e.preventDefault();
                uniforms.mouse.value.x = e.pageX * 2;
                uniforms.mouse.value.y = e.pageY * 2;
            }
        }

         function onWindowResize(event) {
            renderer.setSize(window.innerWidth, window.innerHeight);
            uniforms.resolution.value.x = renderer.domElement.width;
            uniforms.resolution.value.y = renderer.domElement.height;
        }

        function animate() {
            requestAnimationFrame(animate);
            render();
        }

        function render() {
            uniforms.time.value += 0.05;
            renderer.render(scene, camera);
        }
    </script>
</body>

</html>
