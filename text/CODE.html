<link type="text/css" rel="stylesheet" href="../css/code.css" media="all" />
<div class="included">
    // KODELIFE

    #version 150

    uniform float time;
    uniform vec2 resolution;
    uniform vec2 mouse;

    float PI = 3.1415;
    float PI2 = 6.283;

    in VertexData{vec4 v_position;vec3 v_normal;vec2 v_texcoord;} inData;
    out vec4 fragColor;

    vec2 Rotate2D(vec2 uv, float an){
        uv -= .5;
        float si = sin(an), co = cos(an);
        uv *=  mat2(co,-si,si,co);
        uv += .5;
        return uv;}

    float Box(vec2 uv, vec2 sz, float ed){
        sz = vec2(.5)-sz*.5;
        vec2 aa = vec2(ed*.5);
        vec2 m = smoothstep(sz, sz+aa, uv);
        m *= smoothstep(sz, sz+aa, vec2(1.)-uv);
        return m.x*m.y;}

    float sdBox(vec2 uv, vec2 sz){
        vec2 di = abs(uv)-sz;
        return length(min(max(di.x,di.y),0.1))+length(min(max(di.x,di.y),.1));}

    vec2 Offset(vec2 uv){
        vec2 ov;
        if(uv.x>.5) ov.x = uv.x - .5;
        else ov.x = uv.x + .5;

        if(uv.y>.5) ov.y = uv.y - .5;
        else ov.y = uv.y + .5;
        return ov;}

    vec4 Shader(vec2 uv, vec2 mnc){
        uv *= 10.;
        vec2 gv = fract(uv);
        vec2 id = floor(uv);
        vec2 bv = fract(uv);
        float dist = id.x/4.;

        gv = Rotate2D(gv,PI*.25);
        vec2 offsetUV = Offset(gv);

        bv = Rotate2D(bv,PI*.25);
        float d = sdBox(bv-.5, vec2(sin(dist-time/1.5)/5.5+.17));
        float m = smoothstep(.01,.02, d);

        float mx = mnc.x*2.7-1.4;
        vec4 col = vec4(Box(offsetUV,vec2(1.-fract(mx*.355-.5)),.01) + 2.*Box(gv,vec2(fract(mx*.355-.5)),.01))*m;
        return col;}

    void main(void){
        vec2 uv = (gl_FragCoord.xy-.5*resolution.xy)/resolution.y;
        vec4 col = Shader(uv, mouse);
        fragColor = col;}

</div>
